<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TikTok Clone - Plateforme de partage de vid√©os courtes. Cr√©ez, partagez et d√©couvrez des vid√©os cr√©atives.">
    <meta name="keywords" content="vid√©os, r√©seaux sociaux, tiktok, partage, cr√©ativit√©">
    <meta name="author" content="TikTok Clone">
    
    <title>TikTok Clone - Partagez vos vid√©os</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Chargement...</p>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay" style="display: none;">
        <div class="modal-content auth-modal">
            <span class="close-btn" onclick="hideLoginModal()">&times;</span>
            <div class="auth-tabs">
                <button type="button" class="auth-tab active" id="loginTabBtn" onclick="switchAuthTab('login')">
                    Connexion
                </button>
                <button type="button" class="auth-tab" id="registerTabBtn" onclick="switchAuthTab('register')">
                    Inscription
                </button>
            </div>
            
            <form id="loginForm" class="auth-form" onsubmit="login(event); return false;">
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="Mot de passe" required>
                </div>
                <button type="submit" class="btn btn-primary">Se connecter</button>
                
                <div class="auth-divider">
                    <span>ou</span>
                </div>
                
                <button type="button" class="btn btn-google" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i> Continuer avec Google
                </button>
                
                <div class="auth-links">
                    <a href="#" onclick="showForgotPassword()">Mot de passe oubli√©?</a>
                </div>
            </form>
            
            <form id="registerForm" class="auth-form" style="display: none;" onsubmit="register(event); return false;">
                <div class="form-group">
                    <input type="text" id="registerUsername" placeholder="Nom d'utilisateur" required>
                </div>
                <div class="form-group">
                    <input type="email" id="registerEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" placeholder="Mot de passe" required>
                </div>
                <div class="form-group">
                    <input type="password" id="registerConfirmPassword" placeholder="Confirmer le mot de passe" required>
                </div>
                <button type="submit" class="btn btn-primary">S'inscrire</button>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Top Navigation -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-video"></i> TikTok Clone
            </div>
            
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Rechercher des vid√©os...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="nav-right">
                <div class="coin-balance" id="coinBalance" onclick="openCoinShop()">
                    <i class="fas fa-coins"></i>
                    <span>0</span>
                </div>
                
                <button class="btn btn-live" id="goLiveBtn" onclick="openLiveSetup()">
                    <i class="fas fa-broadcast-tower"></i> En direct
                </button>
                
                <button class="btn btn-upload" id="createBtn" onclick="openCreateModal()">
                    <i class="fas fa-plus"></i> Cr√©er
                </button>
                
                <div class="user-menu" id="userMenu" onclick="toggleUserMenu()">
                    <img id="userAvatar" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="Profil">
                </div>
            </div>
            
            <!-- User Dropdown Menu -->
            <div class="dropdown-menu" id="userDropdown" style="display: none;">
                <a href="#" onclick="openProfile()"><i class="fas fa-user"></i> Mon profil</a>
                <a href="#" onclick="openWallet()"><i class="fas fa-wallet"></i> Mon portefeuille</a>
                <a href="#" onclick="openSettings()"><i class="fas fa-cog"></i> Param√®tres</a>
                <div class="divider"></div>
                <a href="#" onclick="logout()" style="color: #ff0050;"><i class="fas fa-sign-out-alt"></i> D√©connexion</a>
            </div>
        </nav>

        <!-- Video Feed -->
        <main class="main-content">
            <div class="video-feed" id="videoFeed">
                <!-- Videos will be loaded here -->
            </div>
            
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>D√©couvrir</h3>
                    <a href="#"><i class="fas fa-fire"></i> Tendances</a>
                    <a href="#"><i class="fas fa-music"></i> Musique</a>
                    <a href="#"><i class="fas fa-gamepad"></i> Gaming</a>
                    <a href="#"><i class="fas fa-graduation-cap"></i> √âducation</a>
                </div>
                
                <div class="sidebar-section">
                    <h3>Suivis</h3>
                    <div id="followingList">
                        <!-- Following list -->
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h3>Suggestions</h3>
                    <div id="suggestionsList">
                        <!-- Suggestions -->
                    </div>
                </div>
            </aside>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active"><i class="fas fa-home"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-search"></i></a>
            <a href="#" class="nav-item" onclick="openCreateModal()"><i class="fas fa-plus-square"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-inbox"></i></a>
            <a href="#" class="nav-item" onclick="openProfile()"><i class="fas fa-user"></i></a>
        </div>

        <!-- Create Video Modal -->
        <div id="createModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" onclick="closeCreateModal()">&times;</span>
                <h2>Cr√©er une vid√©o</h2>
                
                <!-- Barre de progression d'upload -->
                <div id="uploadProgressContainer" class="upload-progress-container">
                    <div class="upload-progress-header">
                        <span id="uploadStatus">Pr√©paration de l'upload...</span>
                        <span id="uploadPercentage">0%</span>
                    </div>
                    <div class="upload-progress-bar">
                        <div id="uploadProgressFill" class="upload-progress-fill" style="width: 0%"></div>
                        <div id="uploadProgressText" class="upload-progress-text">0%</div>
                    </div>
                </div>
                
                <div class="video-preview" id="videoPreview">
                    <video id="previewVideo" style="display: none;"></video>
                    <div class="preview-placeholder">
                        <i class="fas fa-video"></i>
                        <p>Aucune vid√©o s√©lectionn√©e</p>
                    </div>
                    
                    <div class="record-indicator" id="recordIndicator" style="display: none;">
                        <i class="fas fa-circle"></i> ENREGISTREMENT
                    </div>
                </div>
                
                <!-- Miniature de la vid√©o -->
                <div class="thumbnail-preview-container">
                    <span class="thumbnail-label">Miniature de la vid√©o</span>
                    <img id="thumbnailPreview" class="thumbnail-preview" src="" alt="Miniature">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-action" onclick="startRecording()" id="recordBtn">
                        <i class="fas fa-video"></i> Filmer
                    </button>
                    <button type="button" class="btn btn-action" onclick="openFilePicker()">
                        <i class="fas fa-upload"></i> Importer
                    </button>
                    <input type="file" id="videoInput" accept="video/*" style="display: none;">
                </div>
                
                <div class="form-section">
                    <label for="videoCaption">L√©gende</label>
                    <textarea id="videoCaption" placeholder="Ajoutez une l√©gende... #hashtag" rows="3"></textarea>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="monetizeVideo">
                            <span>Mon√©tiser cette vid√©o</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>Visibilit√©</label>
                        <select id="videoPrivacy">
                            <option value="public">Public</option>
                            <option value="private">Priv√©</option>
                            <option value="friends">Amis seulement</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="videoFileInfo">Fichier vid√©o</label>
                        <div id="videoFileInfo" class="file-info">
                            <i class="fas fa-file-video"></i>
                            <span>Aucun fichier s√©lectionn√©</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="publishVideo()" id="publishBtn" disabled>
                        <i class="fas fa-paper-plane"></i> Publier
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Stream Setup Modal -->
        <div id="liveSetupModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" onclick="closeLiveSetup()">&times;</span>
                <h2>D√©marrer un live</h2>
                
                <div class="form-section">
                    <div class="form-group">
                        <label>Titre du live</label>
                        <input type="text" id="liveTitle" placeholder="Donnez un titre √† votre live..." maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="liveDescription" placeholder="D√©crivez votre live..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Cat√©gorie</label>
                        <select id="liveCategory">
                            <option value="entertainment">Divertissement</option>
                            <option value="gaming">Gaming</option>
                            <option value="music">Musique</option>
                            <option value="talk">Discussion</option>
                            <option value="education">√âducation</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Visibilit√©</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="livePrivacy" value="public" checked>
                                <span>Public</span>
                            </label>
                            <label>
                                <input type="radio" name="livePrivacy" value="private">
                                <span>Priv√©</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeLiveSetup()">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="startLiveStream()">
                        <i class="fas fa-broadcast-tower"></i> D√©marrer le live
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Stream Interface -->
        <div id="liveInterface" class="live-interface" style="display: none;">
            <div class="live-header">
                <div class="streamer-info">
                    <img id="streamerAvatar" src="" alt="">
                    <div>
                        <h3 id="streamerName"></h3>
                        <span class="viewer-count"><i class="fas fa-eye"></i> <span id="viewerCount">0</span> spectateurs</span>
                    </div>
                </div>
                
                <div class="live-controls">
                    <button type="button" class="btn btn-gift" onclick="openGiftShop()">
                        <i class="fas fa-gift"></i> Cadeaux
                    </button>
                    <button type="button" class="btn btn-danger" onclick="endLiveStream()">
                        <i class="fas fa-stop"></i> Terminer
                    </button>
                </div>
            </div>
            
            <div class="live-content">
                <div class="video-container">
                    <video id="liveVideo" autoplay playsinline></video>
                    <div class="live-stats">
                        <span class="stat"><i class="fas fa-heart"></i> <span id="liveLikes">0</span></span>
                        <span class="stat"><i class="fas fa-gift"></i> <span id="liveGifts">0</span></span>
                        <span class="stat"><i class="fas fa-comment"></i> <span id="liveComments">0</span></span>
                    </div>
                </div>
                
                <div class="live-sidebar">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h4>Chat en direct</h4>
                            <span id="onlineCount">0 en ligne</span>
                        </div>
                        
                        <div class="chat-messages" id="chatMessages">
                            <!-- Chat messages will appear here -->
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Envoyer un message..." maxlength="200">
                            <button type="button" id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                    
                    <div class="viewers-list">
                        <h4>Spectateurs</h4>
                        <div id="viewersList">
                            <!-- Viewers will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gift Shop Modal -->
        <div id="giftShopModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" onclick="closeGiftShop()">&times;</span>
                <h2>Envoyer un cadeau</h2>
                
                <div class="gifts-grid">
                    <div class="gift-item" onclick="selectGift('rose', 1)">
                        <div class="gift-icon">üåπ</div>
                        <div class="gift-name">Rose</div>
                        <div class="gift-price">1 coin</div>
                    </div>
                    
                    <div class="gift-item" onclick="selectGift('crown', 10)">
                        <div class="gift-icon">üëë</div>
                        <div class="gift-name">Couronne</div>
                        <div class="gift-price">10 coins</div>
                    </div>
                    
                    <div class="gift-item" onclick="selectGift('diamond', 50)">
                        <div class="gift-icon">üíé</div>
                        <div class="gift-name">Diamant</div>
                        <div class="gift-price">50 coins</div>
                    </div>
                    
                    <div class="gift-item" onclick="selectGift('rocket', 100)">
                        <div class="gift-icon">üöÄ</div>
                        <div class="gift-name">Fus√©e</div>
                        <div class="gift-price">100 coins</div>
                    </div>
                </div>
                
                <div class="selected-gift" id="selectedGift" style="display: none;">
                    <h3>Cadeau s√©lectionn√©</h3>
                    <div class="gift-preview">
                        <span id="selectedGiftIcon">üåπ</span>
                        <div>
                            <h4 id="selectedGiftName">Rose</h4>
                            <p>Co√ªt: <span id="selectedGiftPrice">1</span> coins</p>
                        </div>
                    </div>
                    
                    <div class="gift-message">
                        <input type="text" id="giftMessage" placeholder="Ajouter un message...">
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="sendGift()">
                        <i class="fas fa-gift"></i> Envoyer le cadeau
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Container -->
        <div id="notificationsContainer" class="notifications-container"></div>
    </div>

    <!-- ========== FIREBASE V8 (Compatibilit√©) ========== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    
    <!-- Main Script -->
    <script src="script.js"></script>
    
    <script>
        // Fonctions UI de base (√©vite les erreurs de r√©f√©rence)
        function openFilePicker() {
            const videoInput = document.getElementById('videoInput');
            if (videoInput) videoInput.click();
        }
        
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        function hideLoginModal() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.style.display = 'none';
        }
        
        function openCreateModal() {
            if (!window.appState || !window.appState.user) {
                const loginModal = document.getElementById('loginModal');
                if (loginModal) loginModal.style.display = 'block';
                return;
            }
            const createModal = document.getElementById('createModal');
            if (createModal) createModal.style.display = 'block';
        }
        
        function closeCreateModal() {
            const modal = document.getElementById('createModal');
            if (!modal) return;
            
            modal.style.display = 'none';
            document.getElementById('videoCaption').value = '';
            document.getElementById('previewVideo').style.display = 'none';
            document.getElementById('previewVideo').src = '';
            document.getElementById('thumbnailPreview').style.display = 'none';
            document.getElementById('thumbnailPreview').src = '';
            document.getElementById('uploadProgressContainer').style.display = 'none';
            document.getElementById('uploadProgressFill').style.width = '0%';
            document.getElementById('uploadProgressText').textContent = '0%';
            document.getElementById('uploadPercentage').textContent = '0%';
            document.getElementById('uploadStatus').textContent = 'Pr√©paration de l\'upload...';
            document.getElementById('publishBtn').disabled = true;
            document.getElementById('videoFileInfo').innerHTML = '<i class="fas fa-file-video"></i><span>Aucun fichier s√©lectionn√©</span>';
            document.getElementById('monetizeVideo').checked = false;
            document.getElementById('videoPrivacy').value = 'public';
            document.querySelector('.preview-placeholder').style.display = 'flex';
        }
        
        function openLiveSetup() {
            if (!window.appState || !window.appState.user) {
                const loginModal = document.getElementById('loginModal');
                if (loginModal) loginModal.style.display = 'block';
                return;
            }
            const liveSetupModal = document.getElementById('liveSetupModal');
            if (liveSetupModal) liveSetupModal.style.display = 'block';
        }
        
        function closeLiveSetup() {
            const modal = document.getElementById('liveSetupModal');
            if (modal) modal.style.display = 'none';
        }
        
        function openGiftShop() {
            const modal = document.getElementById('giftShopModal');
            if (modal) modal.style.display = 'block';
        }
        
        function closeGiftShop() {
            const modal = document.getElementById('giftShopModal');
            if (!modal) return;
            
            modal.style.display = 'none';
            document.getElementById('selectedGift').style.display = 'none';
            document.getElementById('giftMessage').value = '';
            document.querySelectorAll('.gift-item').forEach(item => {
                item.classList.remove('selected');
            });
        }
        
        function selectGift(type, price) {
            // D√©s√©lectionner tous les cadeaux
            document.querySelectorAll('.gift-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // S√©lectionner le cadeau cliqu√©
            const element = event.currentTarget;
            if (element) element.classList.add('selected');
            
            // Mettre √† jour l'affichage
            const iconMap = {
                'rose': 'üåπ',
                'crown': 'üëë',
                'diamond': 'üíé',
                'rocket': 'üöÄ'
            };
            
            const nameMap = {
                'rose': 'Rose',
                'crown': 'Couronne',
                'diamond': 'Diamant',
                'rocket': 'Fus√©e'
            };
            
            document.getElementById('selectedGiftIcon').textContent = iconMap[type] || 'üéÅ';
            document.getElementById('selectedGiftName').textContent = nameMap[type] || 'Cadeau';
            document.getElementById('selectedGiftPrice').textContent = price;
            document.getElementById('selectedGift').style.display = 'block';
            
            // Stocker dans l'√©tat global
            if (window.appState) {
                window.appState.selectedGift = { type, price };
            }
        }
        
        function openProfile() {
            alert('Profil - Fonctionnalit√© √† venir');
        }
        
        function openWallet() {
            alert('Portefeuille - Fonctionnalit√© √† venir');
        }
        
        function openSettings() {
            alert('Param√®tres - Fonctionnalit√© √† venir');
        }
        
        function openCoinShop() {
            alert('Boutique de coins - Fonctionnalit√© √† venir');
        }
        
        function showForgotPassword() {
            alert('Mot de passe oubli√© - Fonctionnalit√© √† venir');
        }
        
        function startRecording() {
            alert('Enregistrement vid√©o - Fonctionnalit√© √† venir');
        }
        
        function openComments(videoId) {
            alert('Commentaires - Fonctionnalit√© √† venir');
        }
        
        // Gestionnaire de fichier vid√©o
        document.addEventListener('DOMContentLoaded', function() {
            const videoInput = document.getElementById('videoInput');
            if (videoInput) {
                videoInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // V√©rifier la taille (max 100MB)
                    const maxSize = 100 * 1024 * 1024; // 100MB
                    if (file.size > maxSize) {
                        alert('Le fichier est trop volumineux (max 100MB)');
                        return;
                    }
                    
                    // Mettre √† jour l'affichage du fichier
                    const fileInfo = document.getElementById('videoFileInfo');
                    if (fileInfo) {
                        fileInfo.innerHTML = `
                            <i class="fas fa-file-video"></i>
                            <span>${file.name} (${(file.size / (1024 * 1024)).toFixed(2)} MB)</span>
                        `;
                    }
                    
                    // Activer le bouton de publication
                    const publishBtn = document.getElementById('publishBtn');
                    if (publishBtn) publishBtn.disabled = false;
                    
                    // Afficher la pr√©visualisation
                    const previewVideo = document.getElementById('previewVideo');
                    if (previewVideo) {
                        previewVideo.style.display = 'block';
                        previewVideo.src = URL.createObjectURL(file);
                        previewVideo.load();
                        
                        // Cacher le placeholder
                        const placeholder = document.querySelector('.preview-placeholder');
                        if (placeholder) placeholder.style.display = 'none';
                        
                        // G√©n√©rer et afficher la miniature
                        previewVideo.addEventListener('loadeddata', function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = previewVideo.videoWidth || 400;
                            canvas.height = previewVideo.videoHeight || 600;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(previewVideo, 0, 0, canvas.width, canvas.height);
                            
                            canvas.toBlob(function(blob) {
                                const thumbnailPreview = document.getElementById('thumbnailPreview');
                                if (thumbnailPreview) {
                                    thumbnailPreview.style.display = 'block';
                                    thumbnailPreview.src = URL.createObjectURL(blob);
                                    
                                    // Stocker dans l'√©tat global
                                    if (window.appState) {
                                        window.appState.currentVideoFile = file;
                                        window.appState.currentThumbnailBlob = blob;
                                    }
                                }
                            }, 'image/jpeg', 0.8);
                        });
                    }
                });
            }
            
            // Fermer les modales en cliquant √† l'ext√©rieur
            document.addEventListener('click', function(event) {
                // Fermer le menu utilisateur
                const userMenu = document.getElementById('userMenu');
                const dropdown = document.getElementById('userDropdown');
                
                if (userMenu && dropdown && !userMenu.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.style.display = 'none';
                }
                
                // Fermer les modales
                const modals = document.querySelectorAll('.modal-overlay');
                modals.forEach(modal => {
                    if (modal.style.display === 'flex' && event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Emp√™cher la fermeture des modales en cliquant √† l'int√©rieur
            document.querySelectorAll('.modal-content').forEach(modalContent => {
                modalContent.addEventListener('click', function(event) {
                    event.stopPropagation();
                });
            });
        });
    </script>
</body>
</html><!-- Fen√™tre modale de cr√©ation -->
<div id="createModal" class="modal">
  <div class="modal-content">
    <span onclick="closeCreateModal()" class="close">&times;</span>
    <h2>Cr√©er une nouvelle vid√©o</h2>
    <form id="createForm">
      <input type="text" placeholder="Titre de la vid√©o" required>
      <textarea placeholder="Description" required></textarea>
      <button type="submit">Publier</button>
    </form>
  </div>
</div>



